import{a as u}from"./index-DhUf4HYW.js";const o=new Map,l=new Map,f=1e3,T=(n,t)=>`${n.trim().toLowerCase()}|${t}`,g=()=>{if(o.size>f){const n=Math.floor(f*.2);Array.from(o.keys()).slice(0,n).forEach(s=>{o.delete(s),l.delete(s)})}},m=n=>{if(!n||!n.trim())return!1;const t=n.trim();return t.length<3?!1:![/^[-_.\/\\]+$/,/^[nN][aA]$/,/^[nN]\/[aA]$/,/^[nN][iI][lL]$/,/^[nN][oO][nN][eE]$/,/^[nN][oO][tT]\s+[aA][pP][pP][lL][iI][cC][aA][bB][lL][eE]$/i,/^[\s\-\.\,\;\:]*$/,/^[aA][sS]\s+[dD][iI][rR][eE][cC][tT][eE][dD]$/i,/^[aA][sS]\s+[nN][eE][eE][dD][eE][dD]$/i,/^[pP][rR][nN]$/i,/^[sS][oO][sS]$/i].some(e=>e.test(t))},p=async(n,t)=>{if(!n||!t||n.trim().length===0||!m(n))return"";const s=n.trim();if(!s||s.length===0)return"";const e=T(s,t),i=o.get(e);if(i){if(typeof i=="string")return console.log("Translation cache hit:",e.substring(0,50)),i;if(i instanceof Promise)return console.log("Translation pending (concurrent request):",e.substring(0,50)),i}const d=l.get(e);if(d)return console.log("Reusing pending translation:",e.substring(0,50)),d;const c=(async()=>{try{console.log("Translating to:",t,"Text length:",s.length);const a=await u.post("/translation/translate",{text:s,targetLanguage:t},{headers:{"X-Skip-Messages":"true"}});let r="";return a.data&&a.data.success&&a.data.data?(r=a.data.data.translatedText||"",console.log("Translation successful")):console.error("Translation failed: Invalid response format"),o.set(e,r),l.delete(e),g(),r}catch(a){l.delete(e),o.delete(e),console.error("Error translating text:",a);const r=a.response?.data?.error||a.message||"Translation failed";return r.includes("404")||r.includes("not found")?console.error("Translation failed: API endpoint not found. Please check the API URL and model name."):r.includes("400")?console.error("Translation failed: Invalid request. The content might be too long or contain unsupported characters."):r.includes("403")?console.error("Translation failed: API access denied. Please check API key."):r.includes("429")?console.error("Translation failed: Rate limit exceeded. Please try again later."):r.includes("quota")&&console.error("Translation failed: API quota exceeded. Please try again later."),""}})();return o.set(e,c),l.set(e,c),c};export{p as translateText};
