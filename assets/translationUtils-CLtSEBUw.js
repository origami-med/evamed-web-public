import{a as f}from"./index-BS-RmnVd.js";const a=new Map,i=new Map,u=1e3,g=(o,r)=>`${o.trim().toLowerCase()}|${r}`,T=()=>{if(a.size>u){const o=Math.floor(u*.2);Array.from(a.keys()).slice(0,o).forEach(t=>{a.delete(t),i.delete(t)})}},m=async(o,r)=>{if(!o||!r||o.trim().length===0)return"";const t=o.trim();if(!t||t.length===0)return"";const e=g(t,r),l=a.get(e);if(l){if(typeof l=="string")return console.log("Translation cache hit:",e.substring(0,50)),l;if(l instanceof Promise)return console.log("Translation pending (concurrent request):",e.substring(0,50)),l}const d=i.get(e);if(d)return console.log("Reusing pending translation:",e.substring(0,50)),d;const c=(async()=>{try{console.log("Translating to:",r,"Text length:",t.length);const s=await f.post("/translation/translate",{text:t,targetLanguage:r},{headers:{"X-Skip-Messages":"true"}});let n="";return s.data&&s.data.success&&s.data.data?(n=s.data.data.translatedText||"",console.log("Translation successful")):console.error("Translation failed: Invalid response format"),a.set(e,n),i.delete(e),T(),n}catch(s){i.delete(e),a.delete(e),console.error("Error translating text:",s);const n=s.response?.data?.error||s.message||"Translation failed";return n.includes("404")||n.includes("not found")?console.error("Translation failed: API endpoint not found. Please check the API URL and model name."):n.includes("400")?console.error("Translation failed: Invalid request. The content might be too long or contain unsupported characters."):n.includes("403")?console.error("Translation failed: API access denied. Please check API key."):n.includes("429")?console.error("Translation failed: Rate limit exceeded. Please try again later."):n.includes("quota")&&console.error("Translation failed: API quota exceeded. Please try again later."),""}})();return a.set(e,c),i.set(e,c),c};export{m as translateText};
